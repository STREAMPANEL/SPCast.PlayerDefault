var uagent=navigator.userAgent.toLowerCase();/safari/.test(uagent)&&!/chrome/.test(uagent)&&(window.location.href="/stream");const RADIO_NAME=settings.radio_name,URL_STREAMING=settings.url_streaming,URL_HOSTNAME=settings.url_hostname,HISTORIC=settings.historic,SP_USERID=settings.sp_userid,DEFAULT_COVER_ART=settings.default_cover_art,SP_MAX_HISTORY=6;window.onload=function(){(new Page).setVolume(),getStreamingData(),setInterval(getStreamingData,1e4);var e=document.getElementsByClassName("cover-album")[0];e.style.height=e.offsetWidth+"px"};var audio=new Audio;function Page(){this.changeTitlePage=function(e=RADIO_NAME){document.title=e},this.refreshCurrentSong=function(e,t){var a=document.getElementById("currentSong"),o=document.getElementById("currentArtist");e!==a.innerHTML&&(a.className="animated flipInY text-uppercase",a.innerHTML=e,o.className="animated flipInY text-capitalize",o.innerHTML=t,setTimeout((()=>{a.className="text-uppercase",o.className="text-capitalize"}),2e3))},this.refreshHistoric=function(e,t){var a=document.querySelectorAll("#historicSong article"),o=document.querySelectorAll("#historicSong article .music-info .song"),n=document.querySelectorAll("#historicSong article .music-info .artist"),i=DEFAULT_COVER_ART,s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var s=JSON.parse(this.responseText),r=s.resultCount?s.results[0].artworkUrl100:i;document.querySelectorAll("#historicSong article .cover-historic")[t].style.backgroundImage="url("+r+")"}var u=e.song.replace(/&apos;/g,"'").replace(/&amp;/g,"&"),c=e.artist.replace(/&apos;/g,"'").replace(/&amp;/g,"&");o[t].innerHTML=u,n[t].innerHTML=c,a[t].classList.add("animated"),a[t].classList.add("slideInRight")},s.open("GET","https://itunes.apple.com/search?term="+e.artist+" "+e.song+"&media=music&limit=1",!0),s.send(),setTimeout((function(){for(var e=0;e<6;e++)a[e].classList.remove("animated"),a[e].classList.remove("slideInRight")}),2e3)},this.refreshCover=function(e="",t){var a=DEFAULT_COVER_ART,o=new XMLHttpRequest;o.onreadystatechange=function(){var o=document.getElementById("currentCoverArt"),n=document.getElementById("bgCover");if(4===this.readyState&&200===this.status){var i=JSON.parse(this.responseText),s=i.resultCount?i.results[0].artworkUrl100:a;a=s!=a?s.replace("100x100bb","512x512bb"):a;var r=s!=a?a.replace("512x512bb","96x96bb"):a,u=s!=a?a.replace("512x512bb","128x128bb"):a,c=s!=a?a.replace("512x512bb","192x192bb"):a,l=s!=a?a.replace("512x512bb","256x256bb"):a,m=s!=a?a.replace("512x512bb","384x384bb"):a;o.style.backgroundImage=`url(${a})`,o.className="animated bounceInLeft",n.style.backgroundImage=`url(${a})`,setTimeout((function(){o.className=""}),2e3),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:t,artwork:[{src:r,sizes:"96x96",type:"image/png"},{src:u,sizes:"128x128",type:"image/png"},{src:c,sizes:"192x192",type:"image/png"},{src:l,sizes:"256x256",type:"image/png"},{src:m,sizes:"384x384",type:"image/png"},{src:a,sizes:"512x512",type:"image/png"}]}))}},o.open("GET",`https://itunes.apple.com/search?term=${t} ${e}&media=music&limit=1`,!0),o.send()},this.changeVolumeIndicator=function(e){document.getElementById("volIndicator").innerHTML=e,"undefined"!=typeof Storage&&localStorage.setItem("volume",e)},this.setVolume=function(){if("undefined"!=typeof Storage){var e=localStorage.getItem("volume")?localStorage.getItem("volume"):80;document.getElementById("volume").value=e,document.getElementById("volIndicator").innerHTML=e}}}function getStreamingData(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){this.response.length;var e=JSON.parse(this.responseText),t=new Page;let o=document.getElementById("currentSong").innerHTML.replace(/&amp;|&apos;/g,(e=>"&amp;"===e?"&":"'")),n=e.currentSong.replace(/&amp;|&apos;/g,(e=>"&amp;"===e?"&":"'")).replace("  "," "),i=e.currentArtist.replace(/&amp;|&apos;/g,(e=>"&amp;"===e?"&":"'")).replace("  "," ");if(document.title=`${n} - ${i} | ${RADIO_NAME}`,o.trim()!==n.trim()){t.refreshCover(n,i),t.refreshCurrentSong(n,i);for(var a=0;a<6;a++)t.refreshHistoric(e.songHistory[a],a)}}};var t=new Date;e.open("GET",`https://scripts.streampanel.net/spcast/player/default/api.php?url=${URL_HOSTNAME}&userid=${SP_USERID}&historic=${HISTORIC}&t=${t.getTime()}`,!0),e.send()}function Player(){this.play=async function(){await audio.play();var e=document.getElementById("volume").value;"undefined"!=typeof Storage&&null!==localStorage.getItem("volume")?audio.volume=intToDecimal(localStorage.getItem("volume")):audio.volume=intToDecimal(e),document.getElementById("volIndicator").innerHTML=e},this.pause=function(){audio.pause()}}function togglePlay(){audio.paused?(audio.src=URL_STREAMING,audio.addEventListener("canplay",(function(){audio.play()})),audio.load()):audio.pause()}function volumeUp(){var e=audio.volume;audio&&audio.volume>=0&&audio.volume<1&&(audio.volume=(e+.01).toFixed(2))}function volumeDown(){var e=audio.volume;audio&&audio.volume>=.01&&audio.volume<=1&&(audio.volume=(e-.01).toFixed(2))}function mute(){if(audio.muted){var e=localStorage.getItem("volume");document.getElementById("volIndicator").innerHTML=e,document.getElementById("volume").value=e,audio.volume=intToDecimal(e),audio.muted=!1}else document.getElementById("volIndicator").innerHTML=0,document.getElementById("volume").value=0,audio.volume=0,audio.muted=!0}function intToDecimal(e){return e/100}function decimalToInt(e){return 100*e}audio.onplay=function(){var e=document.getElementById("playerButton");"fas fa-play"===e.className&&(e.className="fas fa-pause")},audio.onpause=function(){var e=document.getElementById("playerButton");"fas fa-pause"===e.className&&(e.className="fas fa-play")},audio.onvolumechange=function(){audio.volume>0&&(audio.muted=!1)},audio.onerror=function(){confirm("Error on communicate to server. \nClick OK to try again or contact us.")&&window.location.reload()},document.getElementById("volume").oninput=function(){audio.volume=intToDecimal(this.value),(new Page).changeVolumeIndicator(this.value)},document.addEventListener("keydown",(function(e){var t=(e=e||window.event).keyCode||e.which,a=document.getElementById("volume"),o=new Page;switch(t){case 38:volumeUp(),a.value=decimalToInt(audio.volume),o.changeVolumeIndicator(decimalToInt(audio.volume));break;case 40:volumeDown(),a.value=decimalToInt(audio.volume),o.changeVolumeIndicator(decimalToInt(audio.volume));break;case 32:togglePlay();break;case 80:togglePlay();break;case 77:mute();break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:audio.volume=(t-48)/10,a.value=10*(t-48),o.changeVolumeIndicator(10*(t-48));break}}));